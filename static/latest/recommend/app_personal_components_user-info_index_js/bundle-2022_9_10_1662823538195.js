(self.webpackChunk=self.webpackChunk||[]).push([["app_personal_components_user-info_index_js"],{27933:function(e,t,a){"use strict";a.r(t);a(26252),a(83352),a(52077),a(72482),a(5769),a(91572),a(63238),a(29876),a(73712),a(82979),a(6160),a(61849),a(25540),a(30896),a(20936),a(10040),a(5923),a(85246),a(3542),a(68774),a(8373),a(29706),a(86964),a(34630),a(75389),a(81244),a(89981),a(33807),a(62627),a(34950),a(61964);var i=a(17740),s=a(75745),r=a(96785),o=a(21098),n=a(50596),u=a(48832),d=a(60330),l=a(25107),c=a.n(l);a(4948),a(88157),a(8303),a(51743),a(74968),a(9983);var m=c();a(6379),i.default.use(s.ZP),i.default.use(r.ZP),i.default.use(o.Z),i.default.use(n.Z),i.default.use(u.Z),d.Z.config({duration:4}),i.default.prototype.$notification=d.Z;var f=window.Util,p=f.Cookies,h=(f.Base64,f.BaseModel),g=f.util,v=void 0===g?{}:g,I=window.Util.util,w=(I.getEncryptData,I.getPersonalXssRule,window.Util.validate),b=w.isTel,P=w.isUserName,U=(w.isPassward,v.toast);var x={data:function(){return{UserInfoFormElement:this.$form.createForm(this,{name:"userInfo"}),loading:!1}},computed:{userInfo:function(){return this.$store.getters.userInfo}},methods:{resetInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.userInfo.default,a=JSON.parse(JSON.stringify(t));a._id.val=this.userInfo._id,a.userPic.previewUrl=this.userInfo.userPic,a.time.val=this.userInfo.time,a.name.val=this.userInfo.name,a.userName.val=this.userInfo.userName,a.phone.val=this.userInfo.phone,a.age.val=this.userInfo.age,a.sex.val=this.userInfo.sex,this.$store.commit("updateUserInfo",{isEdit:!1,data:a},e)},submitUserInfo:function(){var e=this;if(this.userInfo.isLogin&&this.userInfo.isSelf){var t=this.userInfo.data,a=t.name,i=t.userName,s=t.phone,r=t.age,o=t.sex,n=t.userPic,u=this.userInfo.name,d=this.userInfo.userName,l=this.userInfo.phone,c=this.userInfo.age,m=this.userInfo.sex,f={},g=!1;if(u!=a.val&&(f.name=a.val,g=!0),d!=i.val&&(f.userName=i.val,g=!0),l!=s.val&&(f.phone=s.val,g=!0),c!=r.val&&(f.age=r.val,g=!0),m!=o.val&&(f.sex=o.val,g=!0),!g&&!n.isChange)return void this.$store.commit("updateUserInfo",{isEdit:!1});if(!(a.status||i.status||s.status||r.status||o.status)){if(g)f.id=p.get("u"),new h({type:"post",url:"/update_user_info",data:f}).promise.then((function(t){if(t&&t.data){var a=t.data,i=a._id,s=a.userName,r=a.name,o=a.age,n=a.sex,u=a.phone,d=a.userPic,l=a.linkUser,c=a.time;e.$store.commit("updateUserInfo",{_id:i,userName:s,name:r,age:o,sex:n,phone:u,userPic:d,linkUser:l,time:c}),e.resetInfo(),U.bind(e)("个人信息修改成功")}}),(function(t){U.bind(e)(t.msg)}));if(n.isChange){var v=this.transBase64ToFormData(n.previewUrl);new h({upload:!0,type:"post",url:"/upload",data:v}).promise.then((function(t){t&&t.data&&(e.$store.commit("updateUserInfo",{userPic:t.data.userPic,isEdit:!1}),U.bind(e)("头像修改成功"))}),(function(t){U.bind(e)(t)}))}}}else U.bind(e)("必须登录状态下才能修改")},transBase64ToFormData:function(e){for(var t=e.split(","),a=window.atob(t[1]),i=/(image\/([\w]{3,4}))\;/.exec(t[0]),s=[],r=0;r<a.length;r++)s.push(a.charCodeAt(r));var o=new Blob([new Uint8Array(s)],{type:i[1]}),n=new FormData;return n.append("file",o,Date.now()+"-user-pic."+i[1].split("/")[1]),n.append("enctype","“multipart/form-data”"),n.append("originImagUrl",this.userInfo.userPic),n},cancelUserInfoChange:function(){this.resetInfo({isEdit:!1})},editUserInfo:function(){this.userInfo.isLogin&&this.userInfo.isSelf?(this.resetInfo({isEdit:!0}),this.$store.commit("updateUserInfo",{isEdit:!0})):U.bind(this)("必须登录状态下才能修改")},createFormFile:function(e){var t=e.file,a=e.action,i=new FormData;return i.append("file",t),i.append("action",a),i},submitCutedPic:function(){for(var e=document.querySelector(".preview-img canvas"),t=e.toDataURL("image/jpeg",1),a=1;t.length>204800;)a-=t.length>614400?.45:.02,t=e.toDataURL("image/jpeg",a);this.$store.commit("updateUserPic",{previewUrl:t}),this.triggerPreviewImg({isPreview:!1})},cutImage:function(e){var t=e.cutWidth,a=e.cutHeight,i=e.startX,s=e.startY,r=document.querySelector(".preview-img canvas"),o=document.querySelector(".preview-img img"),n=r.getContext("2d");r.width=t,r.height=a,n.clearRect(0,0,t,a),n.drawImage(o,i,s,t,a,0,0,t,a),this.$store.commit("updateUserPic",{startY:s,startX:i,cutHeight:a,cutWidth:t,displayCanvas:"block"})},mousedown:function(e){var t=window.J,a="canvas"==e.target.tagName.toLowerCase()?e.target.parentNode:e.target,i=t.elePosition(a),s=e.clientX-i.left,r=e.clientY-i.top;window.originX=null,window.originY=null,this.$store.commit("updateUserPic",{isDrag:!0,startX:s,startY:r,displayCanvas:"none",offset:i})},mousemove:function(e){if(this.userInfo.data.userPic.isDrag){var t=this.userInfo.data.userPic,a=t.offset,i=t.startX,s=t.startY,r=e.clientX-a.left-(window.originX||i),o=e.clientY-a.top-(window.originY||s);r<0&&(window.originX=window.originX?window.originX:i,i=Math.abs(e.clientX-a.left),r=Math.abs(e.clientX-a.left-window.originX)),o<0&&(window.originY=window.originY?window.originY:s,s=Math.abs(e.clientY-a.top),o=Math.abs(e.clientY-a.top-window.originY)),this.cutImage({cutWidth:r,cutHeight:o,startX:i,startY:s})}},mouseup:function(e){this.$store.commit("updateUserPic",{isDrag:!1})},triggerPreviewImg:function(e){var t=e.isPreview,a=void 0!==t&&t,i=e.previewUrl,s=e.isChange,r={preview:a};i&&(r.previewUrl=i),s&&(r.isChange=s),this.$store.commit("updateUserPic",r)},customRequest:function(e){var t,a,i,s=this;t=e.file,a=function(e){var t=document.querySelector(".user-img-content");s.loading=!1,s.triggerPreviewImg({isPreview:!0,previewUrl:e,isChange:!0});var a=s;setTimeout((function(){var e=document.querySelector(".preview-img canvas");!function(e){var t,a,i=e.img,s=e.canvas,r=(e.wrapper,e.scale),o=void 0===r?10:r,n=e.that,u=(i.width||110)*o,d=(i.height||110)*o,l=s.getContext("2d"),c=0,m=0;s.height=d,s.width=u,l.clearRect(0,0,u,d),l.drawImage(i,0,0,u,d);var f=s.toDataURL("image/jpeg",1);n.$store.commit("updateUserPic",{height:d,width:u,url:f}),setTimeout((function(){i=document.querySelector(".preview-img img"),d==u?(t=u,a=d):d>u?(s.height=u,s.width=u,t=u,a=u,m=.5*(d-u),l.drawImage(i,c,m,t,a,0,0,t,a),n.$store.commit("updateUserPic",{startY:m,startX:0,cutHeight:t,cutWidth:a})):(s.height=d,s.width=d,t=d,a=d,c=.5*(u-d),l.drawImage(i,c,m,t,a,0,0,t,a),n.$store.commit("updateUserPic",{startY:0,startX:c,cutHeight:t,cutWidth:a}))}),1)}({img:t,wrapper:".preview-img",canvas:e,that:a})}),1)},(i=new FileReader).addEventListener("load",(function(){return a(i.result)})),i.readAsDataURL(t)},beforeUpload:function(e,t){window.File=!1;var a="image/jpeg"===e.type||"image/png"===e.type;a||this.$message.error("You can only upload JPG file!");var i=e.size/1024/1024<2;return i||this.$message.error("Image must smaller than 2MB!"),a&&i},changePhoneNumber:function(e){var t=e.target.value,a=b(t)?"":"error",i=""==t?"请输入手机号":""==a?"":"请输入正确的手机号";this.$store.commit("updateUserPhone",{val:t,status:a,helpInfo:i})},changeNickName:function(e){var t=e.target.value||"",a=P(t)||""==t?"":"error",i=""==t?"":""!=a?"只支持中英文和数字，不支持空格等其他特殊字符，长度必须小于17":"";this.$store.commit("updateUserNickname",{val:t,status:a,helpInfo:i})},changeName:function(e){var t=e.target.value||"",a=P(t)||""==t?"":"error",i=""==t?"":""!=a?"只支持中英文和数字，不支持空格等其他特殊字符，长度必须小于17":"";this.$store.commit("updateUserName",{val:t,status:a,helpInfo:i})},changeSex:function(e){var t=e.target.value||"";this.$store.commit("updateUserSex",{val:t,status:"",helpInfo:""})},changeAge:function(e){var t=e||"";this.$store.commit("updateUserAge",{val:t,status:"",helpInfo:""})},clearUserInfoForm:function(){this.$store.commit("clearUserInfoForm")}},template:m};t.default=x},25107:function(e){e.exports='<div class="user-info-wrapper" v-if="userInfo.isLogin"> <a-form :form="UserInfoFormElement" layout="vertical"> <div class="form-item-wrapper needMouse"> <a-form-item label="昵称" :validate-status="userInfo.data.userName.status" :help="userInfo.data.userName.helpInfo" class="form-item-inner"> <a-input :value="userInfo.isEdit?userInfo.data.userName.val:userInfo.userName" @change="changeNickName" :placeholder="userInfo.isEdit?\'请输入昵称\':\'\'" :disabled="!userInfo.isEdit"/> </a-form-item> <a-form-item label="手机号" :validate-status="userInfo.data.phone.status" :help="userInfo.data.phone.helpInfo" class="form-item-inner"> <a-input :value="userInfo.isEdit?userInfo.data.phone.val:userInfo.phone" @change="changePhoneNumber" :placeholder="userInfo.isEdit?\'请输入手机号\':\'\'" :disabled="true||!userInfo.isEdit"/> </a-form-item> <a-form-item label="姓名" :validate-status="userInfo.data.name.status" :help="userInfo.data.name.helpInfo" class="form-item-inner"> <a-input :value="userInfo.isEdit?userInfo.data.name.val:userInfo.name" @change="changeName" :placeholder="userInfo.isEdit?\'请输入姓名\':\'\'" :disabled="!userInfo.isEdit"/> </a-form-item> </div> <div class="form-item-wrapper"> <a-form-item label="年龄" :validate-status="userInfo.data.age.status" :help="userInfo.data.age.helpInfo" class="form-item-inner needMouse"> <a-input-number :value="userInfo.isEdit?userInfo.data.age.val:userInfo.age" :min="1" :max="200" @change="changeAge" :placeholder="userInfo.isEdit?\'请输入\':\'\'" :disabled="!userInfo.isEdit"/> </a-form-item> <a-form-item label="性别" :validate-status="userInfo.data.sex.status" :help="userInfo.data.sex.helpInfo" class="form-item-inner"> <a-checkbox @click="changeSex" :disabled="!userInfo.isEdit" value="male" :checked="(userInfo.isEdit?userInfo.data.sex.val:userInfo.sex)==\'male\'?true:false">男</a-checkbox> <a-checkbox @click="changeSex" :disabled="!userInfo.isEdit" value="female" :checked="(userInfo.isEdit?userInfo.data.sex.val:userInfo.sex)==\'female\'?true:false">女</a-checkbox> </a-form-item> <a-form-item label="头像" :validate-status="userInfo.data.userPic.status" :help="userInfo.data.userPic.helpInfo" class="form-item-inner user-img-upload-wrapper"> <a-upload :disabled="!userInfo.isEdit" name="user-pic" list-type="picture-card" class="avatar-uploader" :show-upload-list="false" action="/ajax/upload" :before-upload="beforeUpload" :custom-request="customRequest"> <div class="user-img-wrapper"> <span class="modify-img-des">修改头像</span> <img class="user-img-content" :src="userInfo.isEdit?userInfo.data.userPic.previewUrl:userInfo.userPic" alt="用户头像"/> </div> </a-upload> </a-form-item> </div> </a-form> <div class="user-info-footer"> <a-button v-if="!userInfo.isEdit" class="right" type="primary" @click="editUserInfo"> {{userInfo.data.editBtn.val}} </a-button> <a-button v-if="userInfo.isEdit" class="right" type="primary" @click="submitUserInfo"> {{userInfo.data.submitBtn.val}} </a-button> <a-button v-if="userInfo.isEdit" class="right mr12" @click="cancelUserInfoChange"> {{userInfo.data.cancelBtn.val}} </a-button> </div> <a-modal class="user-img-editor-wrapper" :visible="userInfo.data.userPic.preview" @cancel="triggerPreviewImg" @ok="submitCutedPic" :centered="true" okText="确认裁剪" cancelText="使用原图" width="auto"> <h2 style="line-height:40px;height:40px">用鼠标点击灰色区域拖动来裁剪图片，默认裁剪中间正方形区域</h2> <div @mousedown="mousedown" @mouseup="mouseup" @mousemove="mousemove" class="preview-img" :class="userInfo.data.userPic.preview?\'\':\'hidden\'" :style="{\'height\':userInfo.data.userPic.height+\'px\',\'width\':userInfo.data.userPic.width+\'px\'}"> <img :src="userInfo.data.userPic.url" alt="" :style="{\'height\':userInfo.data.userPic.height+\'px\',\'width\':userInfo.data.userPic.width+\'px\'}"> <canvas @mousedown="mousedown" class="cut-canvas" :style="{\'display\':userInfo.data.userPic.displayCanvas,\'top\':userInfo.data.userPic.startY+\'px\',\'left\':userInfo.data.userPic.startX+\'px\',\'height\':userInfo.data.userPic.cutHeight+\'px\',\'width\':userInfo.data.userPic.cutWidth+\'px\'}"></canvas> <div class="cut-master"></div> </div> </a-modal> </div> '},6379:function(e,t,a){"use strict";a.r(t),t.default={"user-info-wrapper":"user-info-wrapper","avatar-uploader":"avatar-uploader","ant-upload":"ant-upload","ant-upload-select-picture-card":"ant-upload-select-picture-card","ant-upload-text":"ant-upload-text",plus_icon:"plus_icon","user-img-wrapper":"user-img-wrapper","modify-img-des":"modify-img-des","user-img-content":"user-img-content","user-info-footer":"user-info-footer","ant-upload-disabled":"ant-upload-disabled","user-img-editor-wrapper":"user-img-editor-wrapper","ant-modal-body":"ant-modal-body","preview-img":"preview-img","cut-master":"cut-master","fade-enter":"fade-enter","fade-appear":"fade-appear","fade-leave":"fade-leave","zoom-enter":"zoom-enter","zoom-appear":"zoom-appear","zoom-leave":"zoom-leave","ant-input-number-disabled":"ant-input-number-disabled","ant-input-number-input-wrap":"ant-input-number-input-wrap","anticon-up":"anticon-up","anticon-down":"anticon-down","ant-checkbox-checked":"ant-checkbox-checked"}}}]);