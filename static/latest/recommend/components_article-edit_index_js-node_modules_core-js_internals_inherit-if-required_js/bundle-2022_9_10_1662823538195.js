(self.webpackChunk=self.webpackChunk||[]).push([["components_article-edit_index_js-node_modules_core-js_internals_inherit-if-required_js","components_article-edit_index_js"],{76112:function(t,e,i){"use strict";i.r(e);i(23938),i(98010),i(63238),i(5769),i(56446),i(17460),i(14078),i(55849),i(25901),i(92189),i(91047),i(15610),i(72410),i(83352),i(52077);var r=i(17740),a=i(24204),n=i(60330),o=i(53940),l=(i(36480),i(42301),i(59810)),c=i.n(l),s=i(54922),u=i.n(s),d=i(20560),g=i.n(d);function m(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}i(89790),i(9983),i(2413),i(55933),c().register("modules/imageResize",u());var f=g();r.default.use(a.Z),n.Z.config({duration:1}),r.default.prototype.$notification=n.Z;var h=window.Util,b=h.Cookies,v=h.Base64,q=h.BaseModel,w=(h.Xss,h.util),y=void 0===w?{}:w,x=window.Util.util,k=(x.getEncryptData,x.getPersonalXssRule,window.Util.validate),F=(k.isTel,k.isUserName),T=(k.isPassward,y.toast),A={data:function(){return{content:"",editorOption:{placeholder:"请输入内容,  点右上角可关闭文章",modules:{toolbar:[["bold","italic","underline","strike"],["clean"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["image"]],imageResize:{displayStyles:{backgroundColor:"black",border:"none",color:"white"},modules:["Resize","DisplaySize","Toolbar"]}},theme:"snow"}}},mounted:function(){},computed:{articleForm:function(){return this.$store.getters.articleForm}},methods:{showTagInput:function(t){this.$store.commit("updateTags",{inputVisible:!0}),r.default.nextTick((function(){t.target.parentNode.querySelector("input").focus()}))},tagContentInputChange:function(t){this.$store.commit("updateTags",{curtentValue:t.target.value})},addTagWrapper:function(t){t.target.blur()},addTag:function(t){var e=this.articleForm.data.tag.curtentValue,i=this.articleForm.data.tag.tagList;e&&-1===i.indexOf(e)&&(i=[].concat(m(i),[e]),this.$store.commit("updateTags",{tagList:i,curtentValue:"",inputVisible:!1}))},delTag:function(t){var e=this.articleForm.data.tag.tagList;if(e&&e.length){var i=e.filter((function(e){return e!==t}));this.$store.commit("updateTags",{tagList:i})}},changTitle:function(t){var e=t.target.value,i=F(e)?"":"error",r=""==e?"请输入标题":""!=i?"只支持中英文和数字，不支持空格等其他特殊字符，长度必须小于17":"";return this.$store.commit("setArticleFormTitle",{val:e,status:i,helpInfo:r}),{val:e,status:i,helpInfo:r}},validateArticleContent:function(){var t,e,i;return t=window.Util.htmlDecode(document.querySelector(".ql-editor").innerHTML),t=window.Util.pXss.process(t),window.ErrorTags&&window.ErrorTags.length&&(e="error",i=this.getWarnInfo(window.ErrorTags)),this.$store.commit("setArticleFormContent",{val:t,status:e,helpInfo:i}),{val:t,status:e,helpInfo:i}},tabNext:function(t){window.quill.focus()},getWarnInfo:function(t){var e="";return(t=m(new Set(t))).forEach((function(t){e+="<".concat(t,">;")})),window.ErrorTags=[],"文章中不能包含".concat(e,"这类html标签，请删除")},submitArticel:function(){this.articleForm.data.title.val;var t,e=this.changTitle({target:{value:this.articleForm.data.title.val}}),i=this.validateArticleContent(),r=(i.val,i.status),a=(i.helpInfo,{}),n=this;if("error"!==e.status&&"error"!==r){if(this.uglyAllImage(),!(a=this.getParam()).id)return void T.bind(this)("提交失败","请登陆后再提交");t=new q({type:"post",url:"/create_article",data:a}),this.switchSubmitState("submiting"),t.promise.then((function(t){t.state?(T.bind(n)(t.msg),n.clearArticleForm(),n.articleForm.visible=!1,n.$attrs.callback()):T.bind(n)("提交失败",t.msg),n.switchSubmitState("submited")}),(function(t){T.bind(n)("提交失败",t.msg),n.switchSubmitState("submited")}))}},switchSubmitState:function(t){if("submiting"==t){var e=!0,i="提交中...";this.$store.commit("setArticleFormSubmitState",{disableBtn:e,submitText:i})}else{e=!1,i="提交";this.$store.commit("setArticleFormSubmitState",{disableBtn:e,submitText:i})}},clearArticleForm:function(){this.content="";this.$store.commit("setArticleFormContent",{val:"",status:"",helpInfo:""}),this.$store.commit("setArticleFormTitle",{val:"",status:"",helpInfo:""})},getParam:function(){return{title:this.articleForm.data.title.val,content:window.Util.htmlDecode(document.querySelector(".article-editor-wrapper .ql-editor").innerHTML),id:v.decode(b.get("u")||""),tags:this.articleForm.data.tag?this.articleForm.data.tag.tagList:[]}},uglyAllImage:function(){var t=this,e=document.querySelectorAll(".ql-container img");e.length&&e.forEach((function(e){t.uglyImage(e)}))},uglyImage:function(t){t.src;var e=t.width,i=t.height,r=1,a=document.createElement("canvas"),n=a.getContext("2d");a.height=i,a.width=e,n.clearRect(0,0,e,i),n.drawImage(t,0,0,e,i);for(var o=a.toDataURL("image/jpeg",r),l=0;o.length>122880;)r-=o.length>614400?.45:.02,o=a.toDataURL("image/jpeg",r),console.log(++l);t.src=o},closeArticleDrawer:function(){this.articleForm.visible=!1},onEditorBlur:function(t){},onEditorFocus:function(t){},onEditorReady:function(t){window.quill=t},onEditorChange:function(t){t.quill,t.html,t.text}},components:{"quill-editor":o.quillEditor},template:f};e.default=A},15070:function(t,e,i){var r=i(28759),a=i(77530);t.exports=function(t,e,i){var n,o=e.constructor;return o!==i&&"function"==typeof o&&(n=o.prototype)!==i.prototype&&r(n)&&a&&a(t,n),t}},84861:function(t,e,i){"use strict";var r,a,n=i(54276),o=RegExp.prototype.exec,l=String.prototype.replace,c=o,s=(r=/a/,a=/b*/g,o.call(r,"a"),o.call(a,"a"),0!==r.lastIndex||0!==a.lastIndex),u=void 0!==/()??/.exec("")[1];(s||u)&&(c=function(t){var e,i,r,a,c=this;return u&&(i=new RegExp("^"+c.source+"$(?!\\s)",n.call(c))),s&&(e=c.lastIndex),r=o.call(c,t),s&&r&&(c.lastIndex=c.global?r.index+r[0].length:e),u&&r&&r.length>1&&l.call(r[0],i,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(r[a]=void 0)})),r}),t.exports=c},54276:function(t,e,i){"use strict";var r=i(56112);t.exports=function(){var t=r(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},72410:function(t,e,i){"use strict";var r=i(28759),a=i(46526),n=i(7740),o=i(24005),l=i(64088),c=i(89720),s=i(50211)("species"),u=[].slice,d=Math.max,g=i(69955)("slice");i(51695)({target:"Array",proto:!0,forced:!g},{slice:function(t,e){var i,g,m,p=l(this),f=o(p.length),h=n(t,f),b=n(void 0===e?f:e,f);if(a(p)&&("function"!=typeof(i=p.constructor)||i!==Array&&!a(i.prototype)?r(i)&&null===(i=i[s])&&(i=void 0):i=void 0,i===Array||void 0===i))return u.call(p,h,b);for(g=new(void 0===i?Array:i)(d(b-h,0)),m=0;h<b;h++,m++)h in p&&c(g,m,p[h]);return g.length=m,g}})},52077:function(t,e,i){"use strict";var r=i(84861);i(51695)({target:"RegExp",proto:!0,forced:/./.exec!==r},{exec:r})},20560:function(t){t.exports='<a-drawer class="article-editor-wrapper" title="给文章添加标签，更容易进入热搜哦" :placement="\'bottom\'" :height="\'80%\'" :width="720" :visible="articleForm.visible" :body-style="{ paddingBottom: \'80px\' }" @close="closeArticleDrawer"> <a-form-item class="form-item-inner" label="" :validate-status="articleForm.data.title.status" :help="articleForm.data.title.helpInfo"> <div @keydown.prevent.tab="tabNext"> <a-input :value="articleForm.data.title.val" @change="changTitle" placeholder="请输入标题"/> </div> </a-form-item> <a-form-item class="form-item-inner" label="" :validate-status="articleForm.data.content.status" :help="articleForm.data.content.helpInfo"> <quill-editor :content="content" :options="editorOption" @change="onEditorChange($event)" @blur="onEditorBlur($event)" @focus="onEditorFocus($event)" @ready="onEditorReady($event)"></quill-editor> </a-form-item> <div class="article-display-tag"> <span class="personal-tag" v-for="(tag,index) in articleForm.data.tag.tagList"> {{ (tag.length>20)?(tag.slice(0, 20)+\'...\'):tag}} <span class="tag-close" @click="function () {delTag(tag);}">×</span> </span> <a-input type="text" size="small" :style="{ width: \'78px\',display:articleForm.data.tag.inputVisible?\'inline\':\'none\' }" :value="articleForm.data.tag.curtentValue" @change="tagContentInputChange" @blur="addTag" @keyup.enter="addTagWrapper"/> <span @click="showTagInput" class="left addTagBtn" :style="{display:articleForm.data.tag.inputVisible?\'none\':\'inline\'}">+ 添加标签</span> </div> <div :style="{\r\n          position: \'absolute\',\r\n          right: 0,\r\n          bottom: 20,\r\n          width: \'100%\',\r\n          padding: \'10px 24px\',\r\n          background: \'#fff\',\r\n          textAlign: \'right\',\r\n          zIndex: 1,\r\n        }"> <a-button :style="{ marginRight: \'8px\' }" @click="closeArticleDrawer" :size="\'large\'"> 取消 </a-button> <a-button type="primary" @click="submitArticel" :size="\'large\'"> 提交 </a-button> </div> </a-drawer>'},2413:function(t,e,i){"use strict";i.r(e),e.default={"article-editor-wrapper":"article-editor-wrapper","ql-editor":"ql-editor","ql-container":"ql-container","quill-editor":"quill-editor","ql-toolbar":"ql-toolbar","ql-formats":"ql-formats","ql-image":"ql-image","ql-clean":"ql-clean","ql-background":"ql-background","ql-picker":"ql-picker","ql-color-picker":"ql-color-picker","ql-color":"ql-color","ql-align":"ql-align","ql-icon-picker":"ql-icon-picker","ql-size":"ql-size","ql-direction":"ql-direction","ql-indent":"ql-indent","ql-list":"ql-list","ql-header":"ql-header","ql-code-block":"ql-code-block","ql-blockquote":"ql-blockquote","ql-strike":"ql-strike","ql-underline":"ql-underline","ql-italic":"ql-italic","ql-bold":"ql-bold","ant-drawer-wrapper-body":"ant-drawer-wrapper-body","article-display-tag":"article-display-tag","tag-close":"tag-close",addTagBtn:"addTagBtn","personal-tag":"personal-tag"}}}]);